---
title: "Applied Category Theory with Scryer Prolog and CLP(â„¤): a case study in dose-escalation"
subtitle: "Scryer Prolog Meetup 2024 --- Hotel Stefanie, Vienna"
author: "David C. Norris"
filters:
  - diagram
format:
  revealjs:
    embed-resources: true
    auto-stretch: false
diagram:
  engine:
    tikz:
      execpath: pdflatex
      header-includes:
        - '\usepackage[mathscr]{eucal}'
        - '\usepackage{amsmath}'
        - '\usepackage{amssymb}'
        - '\usepackage{mathtools}'
        - '\usepackage{tikz}'
        - '\usepackage{tikz-cd}'
        - '\usetikzlibrary{shapes}'
        - '\newcommand{\D}{\mathcal{D}}'
        - '\newcommand{\Q}{\mathcal{Q}}'
---

::: hidden
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\S}{\mathcal{S}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\Q}{\mathcal{Q}}
\newcommand{\M}{\mathcal{M}}
\newcommand{\IE}{\Q \xrightarrow{\;\;E\;\;} \D}
\newcommand{\E}{\widehat{E}}
\newcommand{\delihat}{\surd\E}
:::

## An update

![Norris & Triska (2024)](Executable-Spec-arXiv-2024.png)

# Orientation to oncology dose-finding

Inertial forces of history

## Up-and-down designs in explosives research

![Example of data from an up-and-down design in explosives research.  Source: Dixon & Mood (1948) "A Method for Obtaining and Analyzing Sensitivity Data" *J. Am. Stat. Assoc.*](Dixon-Mood-Fig1.png)

## 'Sensitivity data' are conceived as inherently *censored*

![](Dixon-Mood-sensitivity-def.png)

## Ethical assumptions

* Typically, dose-finding trials are 'first-in-humans' (FIH) trials

* Oncology drugs are too toxic for healthy-volunteer studies

* So FIH oncology trials are pursued with *therapeutic intent*,
  in patients who have exhausted all standard treatments
  
* Nevertheless, *scientifically* the emphasis in dose-finding trials
  is primarily on toxicity, rather than efficacy

* Thus, participants are "resources" [*sic* --- as recent as 2023!]
  used for learning about drug toxicities

## Statistical assumptions

* Occurrence of a binary 'dose-limiting toxicity' (DLT) is recorded
  after a 'first cycle' of treatment, typically 4 weeks

* A DLT is akin to the explosions of Dixon & Mood

* Each trial participant yields one Bernoulli trial, DLT=0|1

* These are *exchangeable* (participants lack individuality)

* Trial concludes with a 'recommended phase 2 dose' (RP2D)

::: aside
The DTAT research programme rejects many of the foregoing
assumptions, aiming to enable clinical *dose individualization*.
:::

## Pharmacologic assumptions

> Alle Dinge sind Gift, und nichts ist ohne Gift;
> allein die Dosis macht, dass ein Ding kein Gift ist.
> 
> --- Paracelsus, 1538

* Strictly monotone dose-response
* Higher doses are both more efficacious and more toxic


# The '3 + 3' design

The Original Sin of oncology dose finding

## 3 + 3 by example

```{.verbatim code-line-numbers="1-4|6-9|11-14|"}
Level 3                        x x o  |  2/3  <-- Too toxic 
Level 2          o x o  o o o         |  1/6  <-- MTD = RP2D
Level 1   o o o                       |  0/3
Cohort#     1      2      3      4    | Tally 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Level 3                 x x o         |  2/3  <-- Too toxic 
Level 2          o o o         o x o  |  1/6  <-- MTD = RP2D
Level 1   o o o                       |  0/3
Cohort#     1      2      3      4    | Tally
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Level 3                        |
Level 2          x o x         |  2/3  <-- Too toxic 
Level 1   o o o         o o o  |  0/6  <-- MTD = RP2D
Cohort#     1      2      3    | Tally
```

::: {.incremental}
- 'Markov property'
- Synchronous cohorts
:::

## 'Markov property'

![The 'Markov' or 'lack-of-memory' property of 3+3 method as described by Clertant & O'Quigley (2017) "Semiparametric dose finding methods" *J. R. Statist. Soc. B*](Clertant+O'Quigley-2017.png)


## Synchronously dosed cohorts
::: {layout-ncol=2}

![Callaway & Butler (2016) "Researchers question design of fatal French clinical trial" *Nature*](Callaway+Butler-2016-Nature.png){.lightbox}

![Wadman (2006) "London's disastrous drug trial has serious side effects for research" *Nature*](TeGenero.png){.lightbox}
:::

---

:::: {.columns}

::: {.column width="70%"}
![](Skolnik08-Table1.png){.lightbox}
:::

::: {.column width="30%"}
Note the fine print!
:::

::::


::: aside
Skolnik JM, Barrett JS, Jayaraman B, Patel D, Adamson PC. Shortening the timeline of pediatric phase I trials: the rolling six design. *J Clin Oncol.* 2008;26(2):190-195. doi:10.1200/JCO.2007.12.7712
:::

---

:::: {.columns}

::: {.column width="50%"}
![](Frankel20-Table1.png){.lightbox}
:::

::: {.column width="50%"}
Frankel PH, Chung V, Tuscano J, et al. Model of a Queuing Approach for Patient Accrual in Phase 1 Oncology Studies. *JAMA Network Open.* 2020;3(5):e204787-e204787. doi:10.1001/jamanetworkopen.2020.4787

Drowning in a combinatorial explosion of fine print?

:::

::::


## 93 final tallies of the 3-dose 3+3 {.scrollable}

![](hasse3.png){width=80% .lightbox}

## 29 final tallies of the 2-dose 3+3 {.scrollable}

![](hasse2.svg){width=100%}

---

> What can you do with it?
> It's like a lot of yaks jumping about!
> 
> --- Sir Thomas Beecham, on Beethoven's 7th Symphony

## Metagraphs

- *Objects* $a, b, c, ...$
- *Arrows* $f, g, h, ...$
- Operations *Domain* and *Codomain* assigning objects $a = \mathrm{dom} f$ and $b = \mathrm{cod} f$ to each arrow $f$,
  a situation we can depict as
  $$
  a \xrightarrow{f} b.
  $$

::: aside
Saunders Mac Lane. 1998. *Categories for the Working Mathematician.* 2ed.
:::

## Metacategories have in addition ..

- *Identity* operation $\mathrm{id}$ giving an arrow $a \xrightarrow{\mathrm{id}_a} a$ for each $a$
- *Composition* giving for each pair $\langle f, g \rangle$ with $\mathrm{dom}f = \mathrm{cod}g$ an $f \circ g$ such that
``` {.tikz}
%%| width: 100%
%%| height: 40%
\begin{tikzcd}
    a \ar[rrr, "k\circ(g\circ f) = (k\circ g)\circ f"]
    \ar[ddrrr, near end, "g\circ f"{description}]
    \ar[dd, "f"']
    & & & d
    \\ \\
    b \ar[rrr, "g"']
    \ar[uurrr, near end, "k\circ g"{description}]
    & & & c \ar[uu, "k"']
\end{tikzcd}\qquad\text{and}\qquad
\begin{tikzcd}
    a \ar[ddrr, "f"'] \ar[rr, "f"] & & b \ar[dd, "1_b"] \ar[ddrr, "g"]
    \\ \\
    & & b \ar[rr, "g"'] & & c
\end{tikzcd}
```

::: aside
Saunders Mac Lane. 1998. *Categories for the Working Mathematician*, 2ed. pp.7--8
:::


## Category

An interpretation of the preceding axioms within set theory.

![The category **3**](IMG_0328.JPG){width=80%}

## Concrete Categories

* **Set:** sets are the objects, and functions are the arrows

* **Rel:** sets and binary relations

* **Top:** topological spaces and continuous functions

* **Group:** groups and group homomorphisms

* **Poset:** partially ordered sets and monotone maps

## Abstract Categories

* **Monoid:** a category with 1 object
  - Same as a *semigroup with unit*
  - A monoid with inverses is a *group*

* **Preorder:** for any pair $\langle a, b \rangle$, there is *at most* 1 arrow $a \rightarrow b$
  - The arrows $a \rightarrow b$ are often written $a \le b$
  - This definition allows both $a \le b\;$ and $\;b \le a$
  - In a *partial order*, $a \le b \wedge b \le a \Rightarrow a = b$
  - Identity arrows $\Rightarrow$ reflexivity; composition $\Rightarrow$ transitivity

## Dosewise Tallies

```prolog
:- use_module(library(clpz)).
clpz:monotonic.

q_r(T/N, T:U) :- 0 #=< #T, 0 #=< #U, #N #= #T + #U.
```

Denote the set of *dosewise tallies* by
$$
Q = \{t/n \mid t, n \in \N, t \le n\}
$$
or in 'ratio form'
$$
R = \{t\!:\!u \mid t, u \in \N\},
$$
with $u = n - t$ denoting counts of non-toxicities.


## Q is a commutative monoid

$$
\frac{t_1}{n_1} + \frac{t_2}{n_2} = \frac{t_1+t_2}{n_1+n_2},
$$

Observe that $\frac{0}{0} \in Q$ is the unit.

$$
(Q,0/0,+) \cong (\N,0,+)\times(\N,0,+)
$$

## An *evident safety* relation on Q

  Let $\preceq$ be the transitive closure of a preorder relation satisfying,
  \begin{equation}
  \frac{t}{n}\!+\!\frac{1}{1} \;\preceq\; \frac{t}{n} \;\preceq\; \frac{t}{n}\!+\!\frac{0}{1} \quad \forall\; \frac{t}{n} \in Q. \label{lesafcond}
  \end{equation}
  Then the preorder $(Q,\preceq)$ compares the **evident safety** expressed in dosewise tallies, such that we read
  $$
  q_1 \preceq q_2
  $$
  as "$q_1$ is evidently no safer than $q_2$" or "$q_2$ is evidently at least as safe as $q_1$".

---

### $(Q,\preceq,\frac{0}{0},+)$ is a symmetric monoidal preorder

In particular, we have the *monotonicity condition*,
$$
q \preceq q',\; g \preceq g' \implies q + g \preceq q' + g',
$$
arising by induction from the our definition of $\preceq$ in terms of $+$.

## Characterization of $\preceq$ on $R$

$$
t\!:\!u \preceq t'\!:\!u' \iff t \ge t' \;\text{and}\; u \le u'
$$

This follows from the ratio formulation of $\preceq$,
$$
    t\!:\!u + 1\!:\!0 \preceq t\!:\!u \preceq t\!:\!u + 0\!:\!1 \quad \forall\; t\!:\!u \in R.
$$

In $Q$, this translates to,
$$
\frac{t}{n} \preceq \frac{t'}{n'} \iff t \ge t' + \max(0,n-n').
$$

## Extending $\preceq$ to $Q^D$


# Testing Ti*k*Z
``` {.tikz}
%%| width: 50%
%%| height: 50%
\begin{tikzcd}
    {\mathcal{M}} \ar[rr,hook]
    & & {\mathcal{N}} \ar[ll,bend left,"\Sigma"]
\end{tikzcd}
```


# Checking preamble ...

$$
\Q \xrightarrow{E} \D.
$$


# This embeds 2 intutitions:

* We are dealing with an *ordered set* of doses
* The current dose changes *incrementally*


# Pending work

# Thank you!
